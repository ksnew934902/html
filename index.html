<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tic‑Tac‑Toe • Advanced One‑Pager (Fixed)</title>
  <meta name="description" content="One‑page Tic‑Tac‑Toe with Start overlay, PvP/AI, easy/hard AI, undo, history, animated win line, keyboard, theming, persistence, and self‑tests." />
  <style>
    :root {
      --bg: #0b1020;
      --surface: rgba(255,255,255,0.07);
      --text: #ecf0ff;
      --muted: #a7b0d6;
      --primary: #7c93ff;
      --primary-2: #a7ffde;
      --accent: #ff9bd1;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 22px;
      --control-bg: rgba(255,255,255,.06);
      --control-bg-hover: rgba(255,255,255,.12);
    }
    body.light {
      --bg: #f7f8ff;
      --surface: rgba(0,0,0,0.06);
      --text: #0e1330;
      --muted: #535a78;
      --primary: #4256ff;
      --primary-2: #0bb;
      --accent: #d32cff;
      --shadow: 0 8px 24px rgba(20,20,40,.12);
      --control-bg: rgba(0,0,0,.06);
      --control-bg-hover: rgba(0,0,0,.12);
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 10% -10%, #1b2557, transparent),
                  radial-gradient(800px 800px at 120% 10%, #3c1f4d, transparent),
                  var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
      transition: background-color .3s ease, color .3s ease;
    }

    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container { max-width: 1200px; margin-inline: auto; padding: 24px; }

    header.hero { position: relative; padding: 64px 0 32px; text-align: center; overflow: hidden; }
    .orbital { position: absolute; inset: -20vh -10vw auto auto; height: 70vh; width: 70vh; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), transparent 60%), radial-gradient(circle at 70% 70%, rgba(255,255,255,.05), transparent 60%); border-radius: 50%; filter: blur(20px); opacity: .6; pointer-events: none; animation: float 18s ease-in-out infinite; }
    @keyframes float { 0%,100%{ transform: translateY(-6px) rotate(0deg); } 50%{ transform: translateY(6px) rotate(10deg);} }

    h1.title { font-size: clamp(2rem, 5vw, 4rem); margin: 0 0 12px; letter-spacing: .5px; }
    p.subtitle { margin: 0 auto; max-width: 900px; color: var(--muted); }

    .card { background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border: 1px solid rgba(255,255,255,.12); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(10px); }
    .grid { display: grid; gap: 24px; grid-template-columns: repeat(12, 1fr); align-items: start; margin-top: 32px; }
    .span-7 { grid-column: span 7; }
    .span-5 { grid-column: span 5; }
    @media (max-width: 1000px){ .span-7, .span-5 { grid-column: 1 / -1; } }

    .controls { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; justify-content: center; margin: 18px 0 10px; }
    .btn, .select { appearance: none; border: 1px solid rgba(255,255,255,.2); background: var(--control-bg); color: var(--text); padding: 10px 14px; border-radius: 14px; font-weight: 600; box-shadow: var(--shadow); cursor: pointer; transition: .25s ease; outline: none; min-height: 42px; }
    .btn:hover, .select:hover { transform: translate(0, -2px); box-shadow: 0 14px 34px rgba(0,0,0,.28); background: var(--control-bg-hover); }
    .btn:active { transform: translate(0, 0); }
    .btn.primary { background: linear-gradient(135deg, var(--primary), var(--primary-2)); color: #00131a; border: none; }
    .btn.ghost { background: transparent; }
    .select { padding-right: 40px; position: relative; }
    .select option { background: var(--bg); color: var(--text); }

    .switch { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
    .switch input { appearance: none; width: 52px; height: 30px; background: var(--surface); border: 1px solid rgba(255,255,255,.15); border-radius: 999px; position: relative; outline: none; transition: background .2s ease; }
    .switch input::after { content: ""; position: absolute; inset: 5px; width: 20px; height: 20px; background: #fff; border-radius: 50%; transition: transform .2s ease; }
    .switch input:checked { background: linear-gradient(135deg, var(--primary), var(--primary-2)); }
    .switch input:checked::after { transform: translateX(22px); }

    .game-card { padding: 22px; }
    .status { display:flex; align-items:center; justify-content:space-between; gap: 12px; flex-wrap: wrap; }
    .status .msg { font-weight: 700; letter-spacing: .3px; }

    .board { margin: 18px auto 8px; width: min(92vw, 520px); aspect-ratio: 1/1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; position: relative; }
    .cell { display: grid; place-items: center; font-size: clamp(2.2rem, 6vw, 3.6rem); font-weight: 900; background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border: 1px solid rgba(255,255,255,.15); border-radius: 18px; cursor: pointer; user-select: none; position: relative; isolation: isolate; transition: transform .08s ease, background .25s ease, border-color .25s ease; }
    .cell:hover { transform: translateY(-2px); }
    .cell[disabled] { cursor: not-allowed; opacity: .6; }

    .cell .mark { filter: drop-shadow(0 6px 12px rgba(0,0,0,.35)); background: radial-gradient(circle at 50% 35%, #fff, #ddd); -webkit-background-clip: text; background-clip: text; color: transparent; }

    .line { position: absolute; height: 8px; background: linear-gradient(90deg, var(--accent), var(--primary-2)); border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.35); transform-origin: left center; opacity: 0; transition: opacity .25s ease; pointer-events: none; }

    .sidebar { padding: 20px; position: sticky; top: 20px; }
    .kpi { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 16px 0; }
    .kpi .pill { padding: 14px; text-align: center; border-radius: 14px; background: var(--surface); border: 1px solid rgba(255,255,255,.12); }
    .kpi .pill .big { font-size: 1.6rem; font-weight: 900; }

    .history { max-height: 280px; overflow: auto; padding-right: 6px; }
    .history button { width: 100%; text-align:left; margin: 6px 0; }

    section { margin: 56px 0; }
    h2 { font-size: clamp(1.6rem, 3vw, 2.2rem); margin: 0 0 8px; }
    p.lead { color: var(--muted); }

    footer { margin: 72px 0 24px; text-align: center; color: var(--muted); }

    .starter { display:flex; align-items:center; justify-content:center; position: absolute; inset:0; border-radius: 18px; background: rgba(0,0,0,.35); backdrop-filter: blur(2px); }
    .starter .panel { background: var(--bg); border: 1px solid rgba(255,255,255,.12); padding: 18px 18px; border-radius: 14px; box-shadow: var(--shadow); text-align:center; }

    .board.finished .cell:hover { transform: none; }
  </style>
</head>
<body>
  <div class="orbital"></div>
  <header class="hero">
    <div class="container">
      <h1 class="title">Tic‑Tac‑Toe, Reimagined</h1>
      <p class="subtitle">A gorgeous, single‑page experience with an advanced on‑page game: PvP & AI, undo & history, win‑line animations, keyboard play, theming, and persistent scores.</p>
      <div class="controls" aria-label="Global controls">
        <label class="switch" title="Toggle light/dark theme">
          <span>Theme</span>
          <input id="themeToggle" type="checkbox" aria-label="Toggle light/dark" />
        </label>
        <button class="btn ghost" id="scrollFeatures" type="button">Explore Features ↓</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="span-7 card game-card" aria-label="Tic Tac Toe game">
        <div class="status">
          <div class="msg" id="statusMsg">Press Start to begin. X goes first.</div>
          <div class="controls">
            <select class="select" id="mode" aria-label="Game mode">
              <option value="pvp">Player vs Player</option>
              <option value="ai">Player vs Computer</option>
            </select>
            <select class="select" id="difficulty" aria-label="AI difficulty">
              <option value="easy">Easy</option>
              <option value="hard" selected>Hard</option>
            </select>
            <button class="btn primary" id="start" type="button">Start</button>
            <button class="btn" id="restart" type="button">Restart</button>
            <button class="btn" id="undo" type="button">Undo</button>
          </div>
        </div>

        <div class="board" id="board" role="grid" aria-label="Tic Tac Toe board"></div>
        <div class="controls" style="justify-content: space-between;">
          <small>Keyboard: arrows/WASD to move, Enter/Space to place</small>
          <small id="turnHint">Turn: X</small>
        </div>
      </section>

      <aside class="span-5 card sidebar" aria-label="Game summary and history">
        <h2>Scoreboard</h2>
        <div class="kpi">
          <div class="pill"><div class="big" id="scoreX">0</div><div>Wins (X)</div></div>
          <div class="pill"><div class="big" id="scoreO">0</div><div>Wins (O)</div></div>
          <div class="pill"><div class="big" id="scoreT">0</div><div>Draws</div></div>
        </div>
        <div class="controls" style="justify-content:space-between;">
          <button class="btn ghost" id="clearScores" type="button">Clear Scores</button>
          <button class="btn ghost" id="swapMarks" type="button">Swap X/O</button>
        </div>

        <h2 style="margin-top:24px;">Move History</h2>
        <div class="history" id="history" aria-live="polite"></div>
      </aside>
    </div>

    <section>
      <h2>How to Play</h2>
      <p class="lead">Get three in a row. Play with a friend or challenge the computer (Easy/Hard). Keyboard supported.</p>
    </section>

    <footer>
      Built with ♥, HTML, CSS, and JS. <span id="testBadge" aria-live="polite"></span>
    </footer>
  </main>

  <script>
    // ===== Utilities =====
    const $ = function(sel, root){ return (root||document).querySelector(sel); };
    const $$ = function(sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); };
    const storage = {
      get: function(key, fallback){ try { var v = JSON.parse(localStorage.getItem(key)); return v==null?fallback:v; } catch(e){ return fallback; } },
      set: function(key, val){ try { localStorage.setItem(key, JSON.stringify(val)); } catch(e){} }
    };

    // ===== Game State =====
    var state = {
      board: [null,null,null,null,null,null,null,null,null],
      xIsNext: true,
      history: [],
      winner: null,
      line: null,
      lock: false,
      scores: storage.get('ttt:scores', { X:0, O:0, T:0 }),
      playerMark: 'X', // human mark in AI mode
      aiMark: 'O',
      started: false
    };

    var boardEl = $('#board');
    var lineEl = null;
    var statusMsg = $('#statusMsg');
    var turnHint = $('#turnHint');

    // ===== Build Board & Overlay =====
    function buildBoard(){
      boardEl.innerHTML = '';
      for(var i=0;i<9;i++){
        var btn = document.createElement('button');
        btn.className = 'cell';
        btn.type = 'button';
        btn.setAttribute('role','gridcell');
        btn.setAttribute('aria-label','Cell '+(i+1));
        (function(idx){
          btn.addEventListener('click', function(){ handleMove(idx, false); });
          btn.addEventListener('keydown', function(e){ handleKey(e, idx); });
        })(i);
        if(!state.started) btn.setAttribute('disabled','');
        boardEl.appendChild(btn);
      }
      // Starter overlay
      var overlay = document.createElement('div');
      overlay.id = 'starter';
      overlay.className = 'starter';
      overlay.innerHTML = '<div class="panel"><div style="margin-bottom:10px; font-weight:800;">Ready to play?</div><button class="btn primary" id="startOverlay" type="button">Start Game</button></div>';
      if(state.started) overlay.style.display = 'none';
      boardEl.appendChild(overlay);
      var so = $('#startOverlay'); if(so) so.addEventListener('click', startGame);
      // Win line inside board
      var l = document.createElement('div'); l.id='line'; l.className='line'; l.style.opacity='0'; boardEl.appendChild(l);
      lineEl = l;
      render();
    }

    function enableBoard(enabled){
      var cells = $$('.cell', boardEl);
      for(var i=0;i<cells.length;i++){
        if(enabled) cells[i].removeAttribute('disabled'); else cells[i].setAttribute('disabled','');
      }
    }

    function handleKey(e, i){
      var cols=3, rows=3; var r=Math.floor(i/cols), c=i%cols; var ni=i;
      var k=e.key;
      if(k==='ArrowUp'||k==='w'||k==='W') ni=((r-1+rows)%rows)*cols+c;
      else if(k==='ArrowDown'||k==='s'||k==='S') ni=((r+1)%rows)*cols+c;
      else if(k==='ArrowLeft'||k==='a'||k==='A') ni=r*cols+((c-1+cols)%cols);
      else if(k==='ArrowRight'||k==='d'||k==='D') ni=r*cols+((c+1)%cols);
      else if(k==='Enter'||k===' '){ e.preventDefault(); handleMove(i,false); return; }
      if(ni!==i){ e.preventDefault(); var tgt=boardEl.children[ni]; if(tgt) tgt.focus(); }
    }

    var wins = [ [0,1,2],[3,4,5],[6,7,8], [0,3,6],[1,4,7],[2,5,8], [0,4,8],[2,4,6] ];
    function available(board){ var out=[]; for(var i=0;i<9;i++){ if(!board[i]) out.push(i); } return out; }
    function checkWinner(board){
      for(var w=0;w<wins.length;w++){
        var a=wins[w][0], b=wins[w][1], c=wins[w][2];
        if(board[a] && board[a]===board[b] && board[b]===board[c]) return { winner: board[a], line: [a,b,c] };
      }
      for(var i=0;i<9;i++){ if(!board[i]) return { winner:null, line:null }; }
      return { winner:'T', line:null };
    }

    function currentPlayer(){ return state.xIsNext ? 'X' : 'O'; }

    function handleMove(i, isAI){
      if((state.lock && !isAI) || state.winner || state.board[i]) return;
      var mark = state.xIsNext ? 'X' : 'O';
      state.board[i] = mark;
      state.history.push({ index:i, player:mark });
      state.xIsNext = !state.xIsNext;
      updateStatus();

      var res = checkWinner(state.board);
      if(res.winner){ finishGame(res.winner, res.line); return; }

      render();

      var mode = $('#mode').value;
      if(mode==='ai' && currentPlayer()===state.aiMark){
        state.lock = true;
        setTimeout(function(){
          var mv = ($('#difficulty').value==='hard') ? bestMove(state.board, state.aiMark) : randomMove(state.board);
          state.lock = false;
          if(mv!=null) handleMove(mv, true);
        }, 220);
      }
    }

    function updateStatus(){
      if(!state.started){ statusMsg.textContent='Press Start to begin. X goes first.'; return; }
      if(!state.winner){ statusMsg.textContent='Your move: '+currentPlayer(); }
      turnHint.textContent='Turn: '+currentPlayer();
    }

    function randomMove(board){ var a = available(board); return a.length? a[Math.floor(Math.random()*a.length)] : null; }

    function bestMove(board, player){
      var opp = player==='X'?'O':'X';
      var a = available(board);
      // 1) Win now
      for(var i=0;i<a.length;i++){ var m=a[i]; var b=board.slice(); b[m]=player; if(checkWinner(b).winner===player) return m; }
      // 2) Block now
      for(i=0;i<a.length;i++){ m=a[i]; b=board.slice(); b[m]=opp; if(checkWinner(b).winner===opp) return m; }
      // 3) Center
      if(board[4]==null) return 4;
      // 4) Minimax
      var best={score:-999, move:a[0]};
      for(i=0;i<a.length;i++){
        m=a[i]; b=board.slice(); b[m]=player;
        var s = minimax(b, false, player, opp, -999, 999, 1);
        if(s>best.score){ best.score=s; best.move=m; }
      }
      return best.move;
    }

    function minimax(board, isMax, ai, human, alpha, beta, depth){
      var r = checkWinner(board);
      if(r.winner){ if(r.winner===ai) return 10-depth; if(r.winner==='T') return 0; return depth-10; }
      var a = available(board);
      if(isMax){
        var best=-999;
        for(var i=0;i<a.length;i++){
          var m=a[i]; var b=board.slice(); b[m]=ai;
          var sc = minimax(b, false, ai, human, alpha, beta, depth+1);
          if(sc>best) best=sc; if(best>alpha) alpha=best; if(beta<=alpha) break;
        }
        return best;
      } else {
        best=999;
        for(i=0;i<a.length;i++){
          m=a[i]; b=board.slice(); b[m]=human;
          sc = minimax(b, true, ai, human, alpha, beta, depth+1);
          if(sc<best) best=sc; if(best<beta) beta=best; if(beta<=alpha) break;
        }
        return best;
      }
    }

    function finishGame(winner, line){
      state.winner = winner; state.line = line;
      if(winner==='T'){ statusMsg.textContent='Draw! Nobody wins.'; state.scores.T++; }
      else { statusMsg.textContent=winner+' wins!'; if(winner==='X'){ state.scores.X++; } else { state.scores.O++; } }
      storage.set('ttt:scores', state.scores);
      boardEl.classList.add('finished');
      drawWinLine(line);
      updateScores();
      render();
    }

    function drawWinLine(line){
      if(!line){ if(lineEl){ lineEl.style.opacity='0'; } return; }
      // Wait two frames so layout settles
      requestAnimationFrame(function(){
        requestAnimationFrame(function(){
          var cells = $$('.cell', boardEl);
          var a = cells[line[0]].getBoundingClientRect();
          var c = cells[line[2]].getBoundingClientRect();
          var bRect = boardEl.getBoundingClientRect();
          var ax = a.left + a.width/2 - bRect.left;
          var ay = a.top + a.height/2 - bRect.top;
          var cx = c.left + c.width/2 - bRect.left;
          var cy = c.top + c.height/2 - bRect.top;
          var dx = cx - ax; var dy = cy - ay; var len = Math.sqrt(dx*dx + dy*dy);
          lineEl.style.left = ax + 'px';
          lineEl.style.top = ay + 'px';
          lineEl.style.width = len + 'px';
          lineEl.style.transform = 'rotate(' + (Math.atan2(dy,dx)*180/Math.PI) + 'deg)';
          lineEl.style.opacity = '1';
        });
      });
    }

    function updateScores(){
      $('#scoreX').textContent = String(state.scores.X);
      $('#scoreO').textContent = String(state.scores.O);
      $('#scoreT').textContent = String(state.scores.T);
    }

    function render(){
      var cells = $$('.cell', boardEl);
      for(var i=0;i<9;i++){
        var v = state.board[i]; var cell = cells[i];
        cell.innerHTML = v ? '<span class="mark" aria-hidden="true">'+v+'</span>' : '';
        cell.setAttribute('aria-disabled', v? 'true':'false');
        if(v || !state.started) cell.setAttribute('disabled',''); else cell.removeAttribute('disabled');
      }
      if(!state.winner){ statusMsg.textContent = state.started ? ('Your move: '+currentPlayer()) : 'Press Start to begin. X goes first.'; }
      turnHint.textContent = 'Turn: ' + currentPlayer();
      renderHistory();
    }

    function renderHistory(){
      var root = $('#history');
      root.innerHTML = '';
      for(var i=0;i<state.history.length;i++){
        var m = state.history[i];
        var b = document.createElement('button'); b.className='btn ghost'; b.type='button';
        b.textContent = (i+1)+'. '+m.player+' at R'+(Math.floor(m.index/3)+1)+'C'+((m.index%3)+1);
        (function(idx){ b.addEventListener('click', function(){ jumpTo(idx); }); })(i);
        root.appendChild(b);
      }
    }

    function jumpTo(histIndex){
      state.board = [null,null,null,null,null,null,null,null,null];
      var moves = state.history.slice(0, histIndex+1);
      for(var i=0;i<moves.length;i++){ var mv=moves[i]; state.board[mv.index]=mv.player; }
      state.xIsNext = (moves.length % 2 === 0);
      state.winner = null; state.line = null; if(lineEl) lineEl.style.opacity='0'; boardEl.classList.remove('finished');
      state.history = moves;
      render();
    }

    // ===== Controls =====
    function reset(){
      state.board = [null,null,null,null,null,null,null,null,null];
      state.xIsNext = true; state.history = []; state.winner = null; state.line = null;
      if(lineEl) lineEl.style.opacity='0'; boardEl.classList.remove('finished');
      render();
      var mode = $('#mode').value;
      if(mode==='ai' && state.started && state.playerMark==='O'){
        setTimeout(function(){ var mv = bestMove(state.board, state.aiMark); if(mv!=null) handleMove(mv, true); }, 50);
      }
    }

    function startGame(){
      state.started = true;
      var starter = $('#starter'); if(starter) starter.remove();
      enableBoard(true);
      statusMsg.textContent = 'Game started! X goes first.';
      reset();
    }

    $('#start').addEventListener('click', startGame);
    $('#restart').addEventListener('click', function(){ if(!state.started) startGame(); else reset(); });
    $('#undo').addEventListener('click', function(){
      if(!state.started || !state.history.length || state.winner) return;
      var mode = $('#mode').value;
      var steps = (mode==='ai' && state.history.length>=2) ? 2 : 1;
      for(var s=0;s<steps;s++){
        var last = state.history.pop();
        if(last){ state.board[last.index] = null; state.xIsNext = (last.player==='X'); }
      }
      state.winner = null; state.line = null; if(lineEl) lineEl.style.opacity='0'; boardEl.classList.remove('finished'); render();
    });

    $('#clearScores').addEventListener('click', function(){ state.scores = {X:0,O:0,T:0}; storage.set('ttt:scores', state.scores); updateScores(); });
    $('#swapMarks').addEventListener('click', function(){
      var was = state.playerMark;
      var tmp = state.playerMark; state.playerMark = state.aiMark; state.aiMark = tmp;
      statusMsg.textContent = 'You are now '+state.playerMark+' (was '+was+').';
      if(state.started) reset();
    });

    $('#mode').addEventListener('change', function(){ if(state.started) reset(); });

    // Theme
    var themeToggle = $('#themeToggle');
    var savedTheme = storage.get('ttt:theme', 'dark');
    if(savedTheme==='light'){ document.body.classList.add('light'); themeToggle.checked = true; }
    themeToggle.addEventListener('change', function(){ document.body.classList.toggle('light', themeToggle.checked); storage.set('ttt:theme', themeToggle.checked ? 'light':'dark'); });

    $('#scrollFeatures').addEventListener('click', function(){ var s = document.querySelectorAll('main section')[1]; if(s) s.scrollIntoView({ behavior:'smooth', block:'start' }); });

    window.addEventListener('resize', function(){ if(state.winner && state.line) drawWinLine(state.line); });

    // Init
    buildBoard();
    updateScores();

    // ===== Self‑tests (non‑UI) =====
    (function runTests(){
      var tests = [];
      function assert(name, cond){ tests.push({name:name, pass: !!cond}); if(!cond) console.error('Assertion failed: ❌ '+name); }
      function eq(a,b){ return JSON.stringify(a)===JSON.stringify(b); }

      // Winner detection
      assert('Row win detected', checkWinner(['X','X','X', null,null,null, null,null,null]).winner==='X');
      assert('Col win detected', checkWinner(['O',null,null, 'O',null,null, 'O',null,null]).winner==='O');
      assert('Diag win detected', checkWinner(['X',null,null, null,'X',null, null,null,'X']).winner==='X');
      assert('Draw detected', checkWinner(['X','O','X','X','O','O','O','X','X']).winner==='T');
      assert('No win on empty board', checkWinner([null,null,null,null,null,null,null,null,null]).winner===null);

      // Available
      var av = available(['X',null,'O', null,null,null, 'O','X',null]);
      assert('Available returns only null indexes', av.length===5 && av.every(function(i){ return [1,3,4,5,8].indexOf(i)>-1; }));

      // Best move immediate win/block
      var board1 = ['X','X',null, null,'O',null, null,null,'O'];
      var mv1 = bestMove(board1, 'X');
      assert('Best move picks winning spot (index 2)', mv1===2);

      var board2 = ['X','X',null, null,null,null, null,null,null];
      var mv2 = bestMove(board2, 'O');
      assert('Best move blocks opponent (index 2)', mv2===2);

      var mv4 = bestMove([null,null,null,null,null,null,null,null,null], 'X');
      assert('Best opening is center (index 4)', mv4===4);

      var res = checkWinner(['O','O','O', null,'X',null, 'X',null,'X']);
      assert('Winner is O with top row', res.winner==='O' && eq(res.line,[0,1,2]));

      var passed = tests.filter(function(t){ return t.pass; }).length;
      var badge = document.getElementById('testBadge');
      badge.textContent = 'Self‑tests: '+passed+'/'+tests.length+' passed';
    })();
  </script>
</body>
</html>
